# Implementation Plan: Brainstorm Persistence

**Branch**: `004-brainstorm-persistence` | **Date**: 2026-02-20 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `specs/004-brainstorm-persistence/spec.md`

## Summary

Extend the brainstorm skill to persist structured summary documents in `brainstorm/` at the project root. Each session produces a numbered markdown file. A `00-overview.md` index tracks all sessions, open threads, and parked ideas.

The implementation modifies a single skill file (`sdd/skills/brainstorm/SKILL.md`) to add document writing, overview management, and revisit detection as new steps in the existing brainstorm workflow.

## Technical Context

**Language/Version**: Markdown (skill prompt definition)
**Primary Dependencies**: Existing brainstorm skill, filesystem (mkdir, ls), existing spec creation flow
**Storage**: Markdown files in `brainstorm/` directory at project root
**Testing**: Manual verification via Claude Code session (per constitution, no automated test suite)
**Target Platform**: Claude Code plugin (cross-platform, runs wherever Claude Code runs)
**Project Type**: Single skill file modification
**Performance Goals**: N/A (interactive skill, not a runtime system)
**Constraints**: Overlay line limit (30 lines per constitution), but this is a core skill change, not an overlay
**Scale/Scope**: Single file modification (`sdd/skills/brainstorm/SKILL.md`)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Guided Development | PASS | Following full SDD workflow: spec, plan, tasks, implement |
| II. Overlay Delegation | PASS | This is a core skill change, not an overlay. No overlay files created. |
| III. Trait Composability | PASS | Not trait-related. Brainstorm persistence is core brainstorm behavior. |
| IV. Quality Gates | PASS | Spec reviewed, plan being generated, tasks will follow. |
| V. Naming Discipline | PASS | Branch `004-brainstorm-persistence` follows `NNN-feature-name` pattern. |
| VI. Skill Autonomy | PASS | Brainstorm skill retains its single purpose (refine ideas into specs). Persistence is an additive output, not a new responsibility. |
| No compiled artifacts | PASS | All changes are Markdown. |
| File organization | PASS | Skill stays in `sdd/skills/brainstorm/SKILL.md`. |

No violations. No complexity tracking needed.

## Project Structure

### Documentation (this feature)

```text
specs/004-brainstorm-persistence/
├── spec.md              # Feature specification
├── plan.md              # This file
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
sdd/
└── skills/
    └── brainstorm/
        └── SKILL.md     # Modified: add persistence steps to existing workflow
```

**Structure Decision**: No new files or directories in the plugin source. The brainstorm skill file is the only source artifact modified. The `brainstorm/` directory and its contents are runtime outputs created in user projects, not plugin source.

## Design

### Approach: Extend Existing Skill Prompt

The brainstorm skill (`SKILL.md`) defines a sequential workflow via its Checklist section. The implementation adds new steps to this checklist and corresponding process sections.

### Changes to SKILL.md

**1. New Checklist Steps (after existing step 8 "Transition")**

Add three new steps to the checklist:

- Step 9: **Write brainstorm document** - structured summary to `brainstorm/NN-topic-slug.md`
- Step 10: **Update overview** - create or refresh `brainstorm/00-overview.md`
- Step 11: **Revisit detection** (moved to session start, before step 3)

The revisit detection logically belongs at session start (after context exploration, before asking questions), but is documented as a later step to keep the checklist readable.

**2. Process Flow Update**

Insert a new node in the process flow diagram between "Offer /speckit.plan or /speckit.implement" and the terminal state. Also insert a revisit-detection diamond after "Explore project context".

**3. New Section: "Brainstorm Document Structure"**

Define the document template inline in the skill (per spec: no `.specify/templates/` file):

```markdown
# Brainstorm: [Topic]

**Date:** YYYY-MM-DD
**Status:** active | parked | abandoned | spec-created
**Spec:** specs/NNNN-feature-name/ (if status is spec-created)

## Problem Framing
[What problem is being explored and why]

## Approaches Considered

### A: [Approach Name]
- Pros: ...
- Cons: ...

### B: [Approach Name]
- Pros: ...
- Cons: ...

## Decision
[What was chosen and why, or "Parked: [reason]" if no decision]

## Open Threads
- [Unresolved question or idea that needs further exploration]
```

**4. New Section: "Overview Document Structure"**

Define the overview template:

```markdown
# Brainstorm Overview

Last updated: YYYY-MM-DD

## Sessions

| # | Date | Topic | Status | Spec |
|---|------|-------|--------|------|
| 01 | YYYY-MM-DD | Topic slug | active/parked/spec-created | NNNN |

## Open Threads
- [Thread description] (from #NN)

## Parked Ideas
- [Idea description] (#NN)
  Reason: [why parked]
```

**5. New Section: "Writing the Brainstorm Document"**

Covers:
- Directory creation: `mkdir -p brainstorm/`
- Number detection: scan `brainstorm/` for existing `NN-*.md` files, extract max number, use max+1
- Slug generation: derive from brainstorm topic (lowercase, hyphens, 2-4 words)
- File writing: create `brainstorm/NN-topic-slug.md` with the structure above
- Status assignment: `spec-created` if spec was generated, `active` if session is ongoing, `parked`/`abandoned` per user choice

**6. New Section: "Updating the Overview"**

Covers:
- If `00-overview.md` doesn't exist: create it
- If it exists: regenerate by scanning all `NN-*.md` files in `brainstorm/`
- For each file: extract frontmatter (date, status, spec reference), extract open threads
- Build sessions table, aggregate open threads, collect parked ideas
- Write updated `00-overview.md`

Overview regeneration is always a full rebuild from source documents (idempotent per FR-010).

**7. New Section: "Revisit Detection"**

Covers:
- After exploring project context (step 2), scan `brainstorm/` for existing documents
- Extract topic slugs from filenames
- Compare current brainstorm topic against existing slugs using keyword overlap
- If a match is found: present AskUserQuestion with options "Create new document" / "Update existing"
- If "update existing": at session end, append a new dated section rather than overwriting

**8. Modification: "Incomplete Session Handling"**

Add to existing flow (when user stops before spec creation):
- Ask: "Save this brainstorm session?" via AskUserQuestion
- If yes: write document with status `parked` or `abandoned`
- If no: skip document writing and overview update
- If session had zero meaningful interaction (no approaches explored): skip the prompt entirely

### Integration Points

The new steps integrate into the existing workflow at these junctions:

| Existing Step | New Behavior |
|---------------|-------------|
| Step 2 (Explore context) | Also scan `brainstorm/` for existing docs, trigger revisit detection |
| Step 6 (Create spec) | Note spec path for brainstorm document's `Spec:` field |
| Step 8 (Transition) | After offering next steps, write brainstorm doc and update overview |
| User stops early | Ask whether to save, then write doc if confirmed |

## Complexity Tracking

No constitution violations. No complexity justifications needed.
